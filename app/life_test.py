from aiogram.client.default import DefaultBotProperties
from aiogram.enums import ParseMode
from aiogram.filters import Command
from aiogram.fsm.state import StatesGroup, State
from aiogram.types import CallbackQuery, InlineKeyboardMarkup, InlineKeyboardButton, Message
from aiogram import Router, Bot, types, F
from aiogram.fsm.context import FSMContext
from aiogram.utils.keyboard import InlineKeyboardBuilder

import app.keyboards as kb
from app.generators import *
from app.states import Form
from config import *
from database import BotDB

db = BotDB('sizif_mode.db')
router = Router()
bot = Bot(token=TG_TOKEN, default=DefaultBotProperties(parse_mode='HTML'))


class SurveyState(StatesGroup):
    question = State()


QUESTIONS = [
    "–í–æ —Å–∫–æ–ª—å–∫–æ –≤—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –ø–æ –±—É–¥–Ω—è–º?",
    "–ê –≤–æ —Å–∫–æ–ª—å–∫–æ –ª–æ–∂–∏—Ç–µ—Å—å —Å–ø–∞—Ç—å?",
    "–ö–∞–∫–æ–π —É –≤–∞—Å –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã?",
    "–°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –≤ —Å—Ä–µ–¥–Ω–µ–º?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –≤–∞—à–∞ —Ä–∞–±–æ—Ç–∞? (1-10)",
    "–£ –≤–∞—Å –µ—Å—Ç—å –¥–µ—Ç–∏?",
    "–° –∫–µ–º –≤—ã –∂–∏–≤—ë—Ç–µ?",
    "–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è —Å –¥—Ä—É–∑—å—è–º–∏?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º? (1-10)",
    "–°–∫–æ–ª—å–∫–æ —É –≤–∞—Å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –±—É–¥–Ω–∏–π –¥–µ–Ω—å?",
    "–ê –≤ –≤—ã—Ö–æ–¥–Ω–æ–π?",
    "–ö–∞–∫ –≤—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è? (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
    "–£ –≤–∞—Å –µ—Å—Ç—å —Ö–æ–±–±–∏?",
    "–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å —Ö–æ–±–±–∏?",
    "–í—ã —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–∏—Ç–∞–Ω–∏–µ–º?",
    "–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å —Å–ø–æ—Ä—Ç–æ–º –∏–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é?",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ —É –≤–∞—Å –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞? (1-10)",
    "–ö–∞–∫–æ–π —É –≤–∞—Å —É—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞ –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é?",
    "–í—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–µ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π? (1-10)",
    "–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –ø–ª–∞–Ω—ã –ø–æ —Å–º–µ–Ω–µ —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —Ä–æ—Å—Ç—É –≤ –∫–∞—Ä—å–µ—Ä–µ?",
    "–ö–∞–∫–∞—è —Å—Ñ–µ—Ä–∞ –∂–∏–∑–Ω–∏ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
    "–ì–¥–µ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –æ–∫–∞–∑–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 –ª–µ—Ç?",
    "–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º? (1-10)",
    "–ï—Å–ª–∏ –±—ã —É –≤–∞—Å –±—ã–ª–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ 2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å, –Ω–∞ —á—Ç–æ –±—ã –≤—ã –∏—Ö –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏? (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)",
    "–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é –≤ —Ü–µ–ª–æ–º? (1-10)",
]

ANSWERS = {
    0: ["–î–æ 6:00", "6:00 ‚Äì 7:00", "7:00 ‚Äì 8:00", "–ü–æ–∑–∂–µ 8:00"],
    1: ["–î–æ 22:00", "22:00 ‚Äì 00:00", "00:00 ‚Äì 02:00", "–ü–æ–∑–∂–µ 02:00"],
    2: ["5/2", "–ì–∏–±–∫–∏–π", "–£–¥–∞–ª—ë–Ω–∫–∞", "–í –æ—Ñ–∏—Å–µ", "–°–≤–æ–π –±–∏–∑–Ω–µ—Å", "–î—Ä—É–≥–æ–µ"],
    3: ["–ú–µ–Ω–µ–µ 4 —á–∞—Å–æ–≤", "4‚Äì6 —á–∞—Å–æ–≤", "6‚Äì8 —á–∞—Å–æ–≤", "–ë–æ–ª–µ–µ 8 —á–∞—Å–æ–≤"],
    4: [str(i) for i in range(1, 11)],
    5: ["–ù–µ—Ç", "–î–∞, 1 —Ä–µ–±–µ–Ω–æ–∫", "–î–∞, 2 –∏ –±–æ–ª–µ–µ"],
    6: ["–û–¥–∏–Ω", "–° –ø–∞—Ä—Ç–Ω—ë—Ä–æ–º", "–° —Ä–æ–¥–∏—Ç–µ–ª—è–º–∏", "–° –¥—Ä—É–∑—å—è–º–∏/—Å–æ—Å–µ–¥—è–º–∏"],
    7: ["–ü–æ—á—Ç–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å", "–ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é", "–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é", "–†–µ–∂–µ, —á–µ–º —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é"],
    8: [str(i) for i in range(1, 11)],
    9: ["–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ç", "–î–æ 1 —á–∞—Å–∞", "1‚Äì3 —á–∞—Å–∞", "–ë–æ–ª–µ–µ 3 —á–∞—Å–æ–≤"],
    10: ["–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ—Ç", "–î–æ 3 —á–∞—Å–æ–≤", "3‚Äì6 —á–∞—Å–æ–≤", "–ë–æ–ª–µ–µ 6 —á–∞—Å–æ–≤"],
    11: ["–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏", "–°–ø–æ—Ä—Ç", "–ß—Ç–µ–Ω–∏–µ", "–•–æ–±–±–∏", "–û–±—â–µ–Ω–∏–µ", "–û—Ç–¥—ã—Ö"],
    12: ["–ù–µ—Ç", "–î–∞, –æ–¥–Ω–æ", "–î–∞, –Ω–µ—Å–∫–æ–ª—å–∫–æ"],
    13: ["–ö–∞–∂–¥—ã–π –¥–µ–Ω—å", "–ù–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é", "–†–∞–∑ –≤ –Ω–µ–¥–µ–ª—é", "–†–µ–¥–∫–æ"],
    14: ["–î–∞, —Å—Ç—Ä–æ–≥–æ", "–í —Ü–µ–ª–æ–º —Å—Ç–∞—Ä–∞—é—Å—å", "–ù–µ—Ç, –µ–º —á—Ç–æ —É–≥–æ–¥–Ω–æ"],
    15: ["0", "1‚Äì2 —Ä–∞–∑–∞", "3‚Äì4 —Ä–∞–∑–∞", "5 –∏ –±–æ–ª–µ–µ —Ä–∞–∑"],
    16: [str(i) for i in range(1, 11)],
    17: ["–ù–∏–∂–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", "–°—Ä–µ–¥–Ω–∏–π", "–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ", "–í—ã—Å–æ–∫–∏–π"],
    18: [str(i) for i in range(1, 11)],
    19: ["–£—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç", "–í–æ–∑–º–æ–∂–Ω–æ", "–°–º–µ–Ω–∞", "–ë–∏–∑–Ω–µ—Å"],
    20: ["–ö–∞—Ä—å–µ—Ä–∞", "–ó–¥–æ—Ä–æ–≤—å–µ", "–û—Ç–Ω–æ—à–µ–Ω–∏—è", "–°–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏–µ", "–≠–º–æ—Ü–∏–∏"],
    21: ["–†–æ—Å—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ", "–°–º–µ–Ω–∞ —Å—Ñ–µ—Ä—ã", "–°–≤–æ–π –±–∏–∑–Ω–µ—Å", "–°—á–∞—Å—Ç–ª–∏–≤–∞—è –∂–∏–∑–Ω—å"],
    22: [str(i) for i in range(1, 11)],
    23: ["–°–ø–æ—Ä—Ç", "–•–æ–±–±–∏", "–û–±—É—á–µ–Ω–∏–µ", "–û–±—â–µ–Ω–∏–µ", "–û—Ç–¥—ã—Ö"],
    24: [str(i) for i in range(1, 11)],
}


def clean_callback_data(text):
    return re.sub(r"[^a-z–∞-—è—ë0-9_]", "", text.lower().replace(" ", "_"))[:30]


def generate_keyboard(question_index):
    buttons = [InlineKeyboardButton(text=option, callback_data=clean_callback_data(option)) for option in
               ANSWERS[question_index]]
    keyboard = [buttons[i:i + 2] for i in range(0, len(buttons), 2)]
    return InlineKeyboardMarkup(inline_keyboard=keyboard)


@router.callback_query(lambda c: c.data in ['life_test'])
async def menu(callback_query: CallbackQuery, state: FSMContext):
    await state.update_data(answers={})
    await state.update_data(current_question=0)
    await send_question(callback_query.from_user.id, state)


async def send_question(chat_id: int, state: FSMContext):
    data = await state.get_data()
    current_question = data.get("current_question", 0)
    last_msg_id = data.get("last_msg_id")

    if current_question < len(QUESTIONS):
        question_text = f"<b>–í–æ–ø—Ä–æ—Å {current_question + 1}/{len(QUESTIONS)}</b>\n\n{QUESTIONS[current_question]}"

        if last_msg_id:
            # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            try:
                await bot.edit_message_text(chat_id=chat_id, message_id=last_msg_id, text=question_text,
                                            reply_markup=generate_keyboard(current_question), parse_mode="HTML")
            except Exception:
                # –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ), –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ
                msg = await bot.send_message(chat_id, question_text, reply_markup=generate_keyboard(current_question),
                                             parse_mode="HTML")
                await state.update_data(last_msg_id=msg.message_id)
        else:
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –µ—Å–ª–∏ last_msg_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
            msg = await bot.send_message(chat_id, question_text, reply_markup=generate_keyboard(current_question),
                                         parse_mode="HTML")
            await state.update_data(last_msg_id=msg.message_id)
    else:
        await finish_survey(chat_id, state)


@router.callback_query(F.data)
async def handle_answer(callback_query: types.CallbackQuery, state: FSMContext):
    data = await state.get_data()
    current_question = data.get("current_question", 0)  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    answers = data.get("answers", {})

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ç–µ–∫—É—â–∏–π –≤–æ–ø—Ä–æ—Å –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ø–∏—Å–∫–∞
    if current_question >= len(QUESTIONS):
        await finish_survey(callback_query.message.chat.id, state)
        return  # –ü—Ä–µ—Ä—ã–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å IndexError

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    answers[QUESTIONS[current_question]] = callback_query.data

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ callback_query.answer)
    await callback_query.answer("–û—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! ‚úÖ")

    await state.update_data(answers=answers, current_question=current_question + 1)
    await send_question(callback_query.message.chat.id, state)


def format_time(time_str):
    """–ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç '600__700' –≤ '06:00‚Äì07:00'"""
    try:
        parts = time_str.split("__")
        formatted_parts = [f"{p[:-2]}:{p[-2:]}" for p in parts]
        return "‚Äì".join(formatted_parts)
    except:
        return time_str  # –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –¥—Ä—É–≥–æ–π, –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å



async def finish_survey(chat_id: int, state: FSMContext):
    data = await state.get_data()
    last_msg_id = data.get("last_msg_id")  # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

    # –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º, –µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å
    if last_msg_id:
        try:
            await bot.delete_message(chat_id=chat_id, message_id=last_msg_id)
        except Exception:
            pass  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏, –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —É–∂–µ —É–¥–∞–ª–µ–Ω–æ


    data = await state.get_data()
    answers = data["answers"]

    wake_time = format_time(answers.get("–í–æ —Å–∫–æ–ª—å–∫–æ –≤—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –ø–æ –±—É–¥–Ω—è–º?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ"))
    sleep_time = format_time(answers.get("–ê –≤–æ —Å–∫–æ–ª—å–∫–æ –ª–æ–∂–∏—Ç–µ—Å—å —Å–ø–∞—Ç—å?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ"))
    regime = f"–ø—Ä–æ—Å—ã–ø–∞—é—Å—å {wake_time} : –∑–∞—Å—ã–ø–∞—é {sleep_time}" if wake_time and sleep_time else "–ù–µ —É–∫–∞–∑–∞–Ω–æ"

    formatted_results = f"""
{regime}
–ì—Ä–∞—Ñ–∏–∫: {answers.get("–ö–∞–∫–æ–π —É –≤–∞—Å –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–†–∞–±–æ—Ç–∞: {answers.get("–°–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –≤ –¥–µ–Ω—å –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –≤ —Å—Ä–µ–¥–Ω–µ–º?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")} —á
–£–¥–æ–≤–ª_—Ä–∞–±–æ—Ç–æ–π: {answers.get("–ù–∞—Å–∫–æ–ª—å–∫–æ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –≤–∞—à–∞ —Ä–∞–±–æ—Ç–∞? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10
–î–µ—Ç–∏: {answers.get("–£ –≤–∞—Å –µ—Å—Ç—å –¥–µ—Ç–∏?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–ñ–∏–≤—ë—Ç: {answers.get("–° –∫–µ–º –≤—ã –∂–∏–≤—ë—Ç–µ?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–î—Ä—É–∑—å—è: {answers.get("–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –ø—Ä–æ–≤–æ–¥–∏—Ç–µ –≤—Ä–µ–º—è —Å –¥—Ä—É–∑—å—è–º–∏?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–û–∫—Ä—É–∂–µ–Ω–∏–µ: {answers.get("–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–∏–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10
–°–≤. –≤—Ä–µ–º—è (–±—É–¥–Ω–∏): {answers.get("–°–∫–æ–ª—å–∫–æ —É –≤–∞—Å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤ –±—É–¥–Ω–∏–π –¥–µ–Ω—å?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–°–≤. –≤—Ä–µ–º—è (–≤—ã—Ö–æ–¥–Ω—ã–µ): {answers.get("–ê –≤ –≤—ã—Ö–æ–¥–Ω–æ–π?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–î–æ—Å—É–≥: {answers.get("–ö–∞–∫ –≤—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è? (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–•–æ–±–±–∏: {answers.get("–£ –≤–∞—Å –µ—Å—Ç—å —Ö–æ–±–±–∏?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–ß–∞—Å—Ç–æ—Ç–∞ —Ö–æ–±–±–∏: {answers.get("–ö–∞–∫ —á–∞—Å—Ç–æ –≤—ã –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å —Ö–æ–±–±–∏?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–ü–∏—Ç–∞–Ω–∏–µ: {answers.get("–í—ã —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –ø–∏—Ç–∞–Ω–∏–µ–º?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–°–ø–æ—Ä—Ç: {answers.get("–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é –∑–∞–Ω–∏–º–∞–µ—Ç–µ—Å—å —Å–ø–æ—Ä—Ç–æ–º –∏–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")} —Ä–∞–∑
–°—Ç—Ä–µ—Å—Å: {answers.get("–ù–∞—Å–∫–æ–ª—å–∫–æ —É –≤–∞—Å –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10
–î–æ—Ö–æ–¥: {answers.get("–ö–∞–∫–æ–π —É –≤–∞—Å —É—Ä–æ–≤–µ–Ω—å –¥–æ—Ö–æ–¥–∞ –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–§–∏–Ω–∞–Ω—Å—ã: {answers.get("–í—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–µ–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —Å–∏—Ç—É–∞—Ü–∏–µ–π? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10
–ö–∞—Ä—å–µ—Ä–∞: {answers.get("–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –ø–ª–∞–Ω—ã –ø–æ —Å–º–µ–Ω–µ —Ä–∞–±–æ—Ç—ã –∏–ª–∏ —Ä–æ—Å—Ç—É –≤ –∫–∞—Ä—å–µ—Ä–µ?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: {answers.get("–ö–∞–∫–∞—è —Å—Ñ–µ—Ä–∞ –∂–∏–∑–Ω–∏ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–¶–µ–ª–∏ (5 –ª–µ—Ç): {answers.get("–ì–¥–µ –±—ã –≤—ã —Ö–æ—Ç–µ–ª–∏ –æ–∫–∞–∑–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ 5 –ª–µ—Ç?", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–°–∞–º–æ—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: {answers.get("–í—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10
–î–æ–ø. 2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å: {answers.get("–ï—Å–ª–∏ –±—ã —É –≤–∞—Å –±—ã–ª–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ 2 —á–∞—Å–∞ –≤ –¥–µ–Ω—å, –Ω–∞ —á—Ç–æ –±—ã –≤—ã –∏—Ö –ø–æ—Ç—Ä–∞—Ç–∏–ª–∏? (–º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}
–£–¥–æ–≤–ª_–∂–∏–∑–Ω—å—é: {answers.get("–ù–∞—Å–∫–æ–ª—å–∫–æ –≤—ã –¥–æ–≤–æ–ª—å–Ω—ã —Å–≤–æ–µ–π –∂–∏–∑–Ω—å—é –≤ —Ü–µ–ª–æ–º? (1-10)", "–ù–µ —É–∫–∞–∑–∞–Ω–æ")}/10"""
    db.update_about(user_id=chat_id, about=formatted_results)
    await state.clear()

    # await bot.send_message(chat_id, formatted_results, parse_mode="HTML")
    await bot.send_message(
        chat_id,
        "‚ú® <b>–ò–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Ç—É—Ç.</b>\n"
        "–ì–æ—Ç–æ–≤—å—Å—è –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ <b>–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ–º—É</b> –∏–∑–º–µ–Ω–µ–Ω–∏—é –≤ –∂–∏–∑–Ω–∏! üí™üî•",
        parse_mode="HTML"
    )

    await asyncio.sleep(3)

    await bot.send_message(
        text=(
            "üöÄ <b>–î–≤–∏–≥–∞–π—Å—è –∫ —Ü–µ–ª—è–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ ‚Äî —Å—Ç–∞–Ω–æ–≤–∏—Å—å –ª—É—á—à–µ –Ω–∞ 1% –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!</b>\n\n"
            "üìå <b>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</b>\n"
            "‚úÖ –í—ã–±–µ—Ä–∏ <b>–ø—Ä–∏–≤—ã—á–∫—É</b> ‚Äî —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã —É–∂–µ –Ω–∞—á–∞—Ç—å –º–µ–Ω—è—Ç—å—Å—è.\n"
            "‚úÖ –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º <b>4-–Ω–µ–¥–µ–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É</b>, –ø–æ—Ç–æ–º—É —á—Ç–æ <b>21 –¥–µ–Ω—å</b> —Å–ª–∏—à–∫–æ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–µ–Ω, –∞ —Ç–∞–∫–æ–π —Ñ–æ—Ä–º–∞—Ç –ø–æ–º–æ–≥–∞–µ—Ç <b>–∑–∞–∫—Ä–µ–ø–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</b>.\n"
            "‚úÖ –ü–æ–≤—Ç–æ—Ä—è–π —à–∞–≥–∏ <b>–∫–∞–∂–¥—ã–π –¥–µ–Ω—å</b>, –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏ –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏!\n\n"
            "üìÖ <b>–ù–∞—á–Ω–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</b>, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø–µ—Ä–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —É–∂–µ —á–µ—Ä–µ–∑ <b>4 –Ω–µ–¥–µ–ª–∏!</b> "
        ),
        chat_id=chat_id,
        parse_mode="HTML",
        reply_markup=kb.sisyphus
    )


